#!/usr/bin/env php
<?php

declare(strict_types=1);
declare(ticks = 1);

use Chetkov\HttpClientMitmproxy\DefaultRegistryFactory;

require_once dirname(__DIR__) . '/bootstrap.php';

$storageDir = $argv[1] ?? MITM_STORAGE_DIR;
$proxyUid = md5(uniqid((string) getmypid(), true));

(new DefaultRegistryFactory())
    ->create($storageDir)
    ->getProxy($proxyUid)
    ->start();